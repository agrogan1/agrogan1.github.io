{
  "hash": "c76002376fc981e5b9a00501aebf264d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Merging Data With Stata\"\nauthor: \"Andy Grogan-Kaylor\"\ndate: 2025-10-10\ncategories: [stats, Stata, workflow]\nexecute: \n  echo: true\ncode-fold: true\ncode-summary: \"Show the code\"\ndraft: false\n---\n\n# Introduction\n\nMerging data is often one of the most simple seeming, but actually complicated tasks in any statistical software program.\n\nIn this post, I try to provide a brief introduction to merging data in Stata.\n\nI use three different data sets:\n\n1. `individual.dta`, a hypothetical data on individuals\n2. `individual2.dta`, a hypothetical data set of supplementary individual data \n3. `region.dta`, a hypothetical data set at the region level.\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\n# Types of Merges\n\nIn Stata, there are four types of merges `1:1` (one to one), `1:m` (one to many), `m:1` (many to one), and the much less used `m:m` (many to many).\n\nIn this post, I consider the `1:1` and `m:1` merges.\n\nLooking at your data using `list` or `browse` is often very helpful. In this post, I use the `list in x` syntax to list the first `x` observations of different data sets.\n\n## One to One (`1:1`) Merges\n\nHere I consider merging `individual.dta`, with the supplementary data `individual2.dta`. \n\nI list out both data files. Notice that each data file has `id` numbers for the *same* individuals. There is one individual in `individual.dta` for each individual in `individual2.dta`.\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nuse individual.dta, clear\n\nlist in 1/3\n\nuse individual2.dta\n\nlist in 1/3\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     |       name   id   age      region |\n     |-----------------------------------|\n  1. | A. Cesaire    1    40   Caribbean |\n  2. | K. Nkrumah    2    50      Africa |\n  3. | L. Senghor    3    60      Africa |\n     +-----------------------------------+\n\n     +----------+\n     | id     x |\n     |----------|\n  1. |  1    90 |\n  2. |  2   100 |\n  3. |  3   110 |\n     +----------+\n```\n\n\n:::\n:::\n\n\n`merge`-ing these two data sets is straightforward. We first `use` the first data set, `individual.dta`, and then `merge` it with `individual2`.dta.\n\nThe output of `merge` is the results of the merging process.\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nuse individual.dta\n\nmerge 1:1 id using individual2.dta\n\nlist in 1/3\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Result                      Number of obs\n    -----------------------------------------\n    Not matched                             0\n    Matched                                 3  (_merge==3)\n    -----------------------------------------\n\n     +-------------------------------------------------------+\n     |       name   id   age      region     x        _merge |\n     |-------------------------------------------------------|\n  1. | A. Cesaire    1    40   Caribbean    90   Matched (3) |\n  2. | K. Nkrumah    2    50      Africa   100   Matched (3) |\n  3. | L. Senghor    3    60      Africa   110   Matched (3) |\n     +-------------------------------------------------------+\n```\n\n\n:::\n:::\n\n\nBecause there are exactly the same `id` numbers in both data sets, we see that 3 observations have matched.\n\n## Many to One (`m:1`) Merges\n\nHere I consider merging `individual.dta`, with the regional level data `region.dta`. \n\nI list out both data files. Notice that each data file has `region` information for the *same* regions. There are multiple individuals in `individual.dta` for each region in `region.dta`.\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nuse individual.dta, clear\n\nlist in 1/3\n\nuse region.dta\n\nlist in 1/2\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     |       name   id   age      region |\n     |-----------------------------------|\n  1. | A. Cesaire    1    40   Caribbean |\n  2. | K. Nkrumah    2    50      Africa |\n  3. | L. Senghor    3    60      Africa |\n     +-----------------------------------+\n\n     +----------------+\n     |    region    z |\n     |----------------|\n  1. | Caribbean   50 |\n  2. |    Africa   60 |\n     +----------------+\n```\n\n\n:::\n:::\n\n\n`merge`-ing these two data sets is straightforward. We first `use` the first data set, `individual.dta`, and then `merge` it with `region.dta`.\n\nThe output of `merge` is the results of the merging process.\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nuse individual.dta\n\nmerge m:1 region using region.dta\n\nlist in 1/3\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Result                      Number of obs\n    -----------------------------------------\n    Not matched                             0\n    Matched                                 3  (_merge==3)\n    -----------------------------------------\n\n     +------------------------------------------------------+\n     |       name   id   age      region    z        _merge |\n     |------------------------------------------------------|\n  1. | L. Senghor    3    60      Africa   60   Matched (3) |\n  2. | K. Nkrumah    2    50      Africa   60   Matched (3) |\n  3. | A. Cesaire    1    40   Caribbean   50   Matched (3) |\n     +------------------------------------------------------+\n```\n\n\n:::\n:::\n\n\nBecause there are exactly the same `region`'s listed in both data sets, we see that 3 observations have matched.\n\n\n\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}