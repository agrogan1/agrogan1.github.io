---
title: "Merging Data With Stata"
author: "Andy Grogan-Kaylor"
date: 2025-11-1
categories: [stats, Stata, workflow]
execute: 
  echo: true
code-fold: true
code-summary: "Show the code"
image: "merge-colorsplash.png"
draft: false
---

# Introduction

Merging data is often one of the most simple seeming, but actually complicated tasks in any statistical software program.

In this post, I try to provide a brief introduction to merging data in Stata.

I use three different data sets:

1. `individual.dta`, a hypothetical data on individuals
2. `individual2.dta`, a hypothetical data set of supplementary individual data 
3. `region.dta`, a hypothetical data set at the region level.

```{r}
#| echo: false
#| output: false

library(Statamarkdown)

library(knitr)

library(kableExtra)

library(haven)

```

```{stata}
#| output: false
#| echo: false

clear 

input str20 name id age str20 region
 "A. Cesaire" 1 40  "Caribbean"
 "K. Nkrumah" 2 50 "Africa"
 "L. Senghor" 3 60 "Africa"
end

save individual.dta, replace

clear

input id x
 1 90
 2 100
 3 110
end

save individual2.dta, replace

clear

input str20 region z
 "Caribbean" 50
 "Africa" 60
end

save region.dta, replace

```

# Quick Look At Each Of The Data Sets

## `individual.dta`

```{stata}

use individual.dta, clear

list

```

## `individual2.dta`

```{stata}

use individual2.dta, clear

list

```

## `region.dta`

```{stata}

  
use region.dta, clear

list

```


# Types of Merges

In Stata, there are four types of merges `1:1` (one to one), `1:m` (one to many), `m:1` (many to one), and the much less used `m:m` (many to many).

In this post, I consider the `1:1` and `m:1` merges.

Looking at your data using `list` or `browse` is often very helpful. In this post, I use the `list in x` syntax to list the first `x` observations of different data sets.

::: {.callout-tip}
## Key Idea

The basic of idea of merging data is:

1. Use the `use` command to open the first data set in your merge.

e.g. `use individual.dta, clear`

2. `merge` with the second data set using the following syntax: 

`merge type-of-merge variables-to-merge-on using second-data-set`.

e.g. `merge 1:1 id using individual2.dta`
:::

## One to One (`1:1`) Merges

Here I consider merging `individual.dta`, with the supplementary data `individual2.dta`. 

I list out some observations in each data file. Notice that each data file has `id` numbers for the *same* individuals. There is one individual in `individual.dta` for each individual in `individual2.dta`.

```{stata}

use individual.dta, clear

list in 1/3

use individual2.dta

list in 1/3

```

`merge`-ing these two data sets is straightforward. We first `use` the first data set, `individual.dta`, and then `merge` it with `individual2`.dta.

The output of `merge` is the results of the merging process.

```{stata, collectcode=TRUE}

use individual.dta, clear

merge 1:1 id using individual2.dta

```

Because there are exactly the same `id` numbers in both data sets, we see that 3 observations have matched.

```{stata}

list in 1/3

```

## Many to One (`m:1`) Merges

Here I consider merging `individual.dta`, with the regional level data `region.dta`. 

I list out some observations for each data file. Notice that each data file has `region` information for the *same* regions. There are multiple individuals in `individual.dta` for each region in `region.dta`.

```{stata}

use individual.dta, clear

list in 1/3

use region.dta, clear

list in 1/2

```

`merge`-ing these two data sets is straightforward. We first `use` the first data set, `individual.dta`, and then `merge` it with `region.dta`.

The output of `merge` is the results of the merging process.

```{stata, collectcode=TRUE}

use individual.dta, clear

merge m:1 region using region.dta

```

Because there are exactly the same `region`'s listed in both data sets, we see that 3 observations have matched.

```{stata}

list in 1/3

```









